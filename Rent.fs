\ Rent.fs

10000 CONSTANT MAX-ORDERS
MAX-ORDERS 2* CONSTANT RENT-HCT-SIZE
VARIABLE CURRENT-VALUE
VARIABLE RENT-VALUE
VARIABLE RENT-HCT-VALUES

: RENT-VALUES
    RENT-HCT-VALUES @ ;

: INIT-RENT
    0 RENT-VALUE ! 
    0 CURRENT-VALUE !
    RENT-VALUES ?DUP IF HCT-FREE THEN
    RENT-HCT-SIZE HCT-NEW RENT-HCT-VALUES ! ;

: S>KEY ( n -- addr c )
    S>D <# #S #> ;

: MAX! ( n addr -- )
    DUP @ ROT MAX SWAP ! ;

: END ( s d -- e )
    + ;

: RENT-VALUE#@ ( t -- n )
    S>KEY RENT-VALUES HCT-GET
    0= IF 0 THEN ;

: RENT-VALUE#! ( n t -- )
    S>KEY RENT-VALUES HCT-INSERT ;

: RENT ( s d b -- )
    CURRENT-VALUE @ + 
    DUP RENT-VALUE MAX! 
    -ROT END RENT-VALUE#! ;

: COLLECT ( t -- )
    RENT-VALUE#@ CURRENT-VALUE MAX! ;
